<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TVTOTO WINLOSS PNG Edition</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,600&family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  /* Luxury palette */
  --obsidian:     #080A0E;
  --void:         #050709;
  --surface-1:    #0D1018;
  --surface-2:    #111520;
  --surface-3:    #161B28;
  --surface-4:    #1C2235;
  --rim:          rgba(255,255,255,0.055);
  --rim-warm:     rgba(212,175,112,0.15);

  --gold-deep:    #8B6914;
  --gold:         #C9962B;
  --gold-mid:     #D4AF70;
  --gold-light:   #E8CC94;
  --gold-pale:    #F5E6C8;
  --gold-glow:    rgba(201,150,43,0.18);
  --gold-glow2:   rgba(212,175,112,0.08);

  --ivory:        #F2EBD9;
  --ivory-dim:    #B8A98C;
  --ivory-mute:   #6B5E48;
  --ivory-ghost:  #2E2820;

  --emerald:      #1A7A5A;
  --emerald-bright: #22C987;
  --emerald-glow: rgba(34,201,135,0.12);

  --rose:         #9A2E3F;
  --rose-bright:  #F06B7C;
  --rose-glow:    rgba(240,107,124,0.12);

  --sapphire:     #1E3A6E;
  --sapphire-bright: #5B8FE8;
  --sapphire-glow: rgba(91,143,232,0.12);

  --font-display: 'Cormorant Garamond', serif;
  --font-body:    'Outfit', sans-serif;
  --font-mono:    'JetBrains Mono', monospace;

  --radius-sm:    6px;
  --radius:       10px;
  --radius-lg:    16px;
  --radius-xl:    22px;

  --ease-luxury:  cubic-bezier(0.16, 1, 0.3, 1);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { scroll-behavior: smooth; }

body {
  font-family: var(--font-body);
  background: var(--obsidian);
  color: var(--ivory-dim);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€â”€ BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bg-canvas {
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  overflow: hidden;
}

/* Radial luxury halos */
.bg-halo {
  position: absolute; border-radius: 50%;
  filter: blur(140px); pointer-events: none;
}
.halo-gold {
  width: 900px; height: 900px;
  background: radial-gradient(circle, rgba(201,150,43,0.07) 0%, transparent 70%);
  top: -300px; right: -200px;
  animation: haloBreath 14s ease-in-out infinite;
}
.halo-ember {
  width: 600px; height: 600px;
  background: radial-gradient(circle, rgba(155,90,30,0.05) 0%, transparent 70%);
  bottom: -100px; left: -150px;
  animation: haloBreath 18s ease-in-out infinite reverse;
}
.halo-cool {
  width: 500px; height: 500px;
  background: radial-gradient(circle, rgba(30,60,110,0.06) 0%, transparent 70%);
  top: 40%; left: 40%;
  animation: haloBreath 22s ease-in-out infinite 4s;
}

@keyframes haloBreath {
  0%,100% { transform: scale(1) translate(0, 0); opacity: 1; }
  33%      { transform: scale(1.08) translate(20px, -15px); opacity: 0.7; }
  66%      { transform: scale(0.94) translate(-15px, 25px); opacity: 0.9; }
}

/* Fine grid texture */
.bg-grid {
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(212,175,112,0.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(212,175,112,0.025) 1px, transparent 1px);
  background-size: 56px 56px;
}

/* Noise grain overlay */
.bg-grain {
  position: fixed; inset: 0; z-index: 1; pointer-events: none; opacity: 0.028;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-size: 200px 200px;
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shell {
  position: relative; z-index: 10;
  max-width: 1680px; margin: 0 auto;
  padding: 20px 20px 60px;
}

/* â”€â”€â”€ GLASS PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel {
  background: var(--surface-2);
  border: 1px solid var(--rim);
  border-radius: var(--radius-lg);
  transition: border-color 0.4s var(--ease-luxury);
}
.panel:hover { border-color: var(--rim-warm); }

.panel-gold {
  background: linear-gradient(145deg, rgba(20,16,10,0.95), rgba(14,11,7,0.98));
  border: 1px solid rgba(201,150,43,0.25);
  border-radius: var(--radius-lg);
}

.panel-inset {
  background: var(--surface-1);
  border: 1px solid var(--rim);
  border-radius: var(--radius);
}

/* Gold ruled line top accent */
.panel-accented {
  position: relative;
  background: var(--surface-2);
  border: 1px solid var(--rim);
  border-radius: var(--radius-lg);
  overflow: hidden;
}
.panel-accented::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
  opacity: 0.6;
}

/* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.header {
  display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
  gap: 16px; padding: 22px 32px; margin-bottom: 20px;
  background: linear-gradient(135deg, rgba(13,16,24,0.95), rgba(8,10,14,0.98));
  border: 1px solid rgba(212,175,112,0.12);
  border-radius: var(--radius-xl);
  position: relative; overflow: hidden;
}
.header::after {
  content: '';
  position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(212,175,112,0.3), transparent);
}

.header-brand {
  display: flex; align-items: center; gap: 18px;
}

.brand-icon {
  width: 50px; height: 50px; flex-shrink: 0;
  background: linear-gradient(145deg, var(--gold-deep), var(--gold));
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 0 1px rgba(201,150,43,0.3), 0 8px 32px rgba(201,150,43,0.2);
  position: relative;
}
.brand-icon::before {
  content: '';
  position: absolute; inset: -1px; border-radius: 15px;
  background: linear-gradient(145deg, rgba(212,175,112,0.5), rgba(139,105,20,0.2));
  z-index: -1;
}

.brand-title {
  font-family: var(--font-display);
  font-size: 28px; font-weight: 600;
  color: var(--ivory);
  letter-spacing: 0.04em;
  line-height: 1;
}
.brand-title em {
  font-style: italic;
  background: linear-gradient(90deg, var(--gold-mid), var(--gold-light), var(--gold-mid));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}

.brand-sub {
  display: flex; align-items: center; gap: 8px; margin-top: 6px;
}

/* â”€â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 3px 10px; border-radius: 20px;
  font-size: 10px; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase;
  font-family: var(--font-body);
}
.badge-gold    { background: rgba(201,150,43,0.12); color: var(--gold-mid);   border: 1px solid rgba(201,150,43,0.25); }
.badge-emerald { background: var(--emerald-glow);   color: var(--emerald-bright); border: 1px solid rgba(34,201,135,0.2); }
.badge-rose    { background: var(--rose-glow);      color: var(--rose-bright);   border: 1px solid rgba(240,107,124,0.2); }
.badge-sapphire{ background: var(--sapphire-glow);  color: var(--sapphire-bright); border: 1px solid rgba(91,143,232,0.2); }
.badge-ivory   { background: rgba(242,235,217,0.06); color: var(--ivory-dim);  border: 1px solid rgba(242,235,217,0.1); }

/* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 18px; border-radius: var(--radius); border: none; outline: none;
  font-family: var(--font-body); font-size: 12px; font-weight: 600;
  letter-spacing: 0.04em; cursor: pointer;
  transition: all 0.3s var(--ease-luxury);
}
.btn:active { transform: scale(0.97); }

.btn-gold {
  background: linear-gradient(135deg, var(--gold-deep), var(--gold));
  color: var(--void);
  box-shadow: 0 4px 20px rgba(201,150,43,0.25), inset 0 1px 0 rgba(255,255,255,0.1);
}
.btn-gold:hover {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  box-shadow: 0 6px 30px rgba(201,150,43,0.4), inset 0 1px 0 rgba(255,255,255,0.15);
  transform: translateY(-1px);
}

.btn-emerald {
  background: linear-gradient(135deg, #0F5C42, #1A8F65);
  color: #A8F0D0;
  box-shadow: 0 4px 20px rgba(26,143,101,0.2);
}
.btn-emerald:hover {
  background: linear-gradient(135deg, #156B4E, #22A876);
  box-shadow: 0 6px 30px rgba(26,143,101,0.35);
  transform: translateY(-1px);
}

.btn-ghost {
  background: rgba(255,255,255,0.04);
  color: var(--ivory-dim);
  border: 1px solid var(--rim);
}
.btn-ghost:hover {
  background: rgba(212,175,112,0.07);
  color: var(--gold-mid);
  border-color: rgba(212,175,112,0.2);
}

.btn-danger {
  background: rgba(154,46,63,0.15);
  color: var(--rose-bright);
  border: 1px solid rgba(154,46,63,0.3);
}
.btn-danger:hover {
  background: rgba(154,46,63,0.25);
}

.btn-lg {
  padding: 13px 24px; font-size: 13px; letter-spacing: 0.08em;
  text-transform: uppercase; border-radius: var(--radius);
}
.btn-full { width: 100%; justify-content: center; }

/* â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.nav-wrap {
  padding: 6px; margin-bottom: 20px;
  background: rgba(8,10,14,0.8);
  border: 1px solid var(--rim);
  border-radius: var(--radius-lg);
  display: flex; gap: 4px; overflow-x: auto;
  backdrop-filter: blur(12px);
}
.nav-wrap::-webkit-scrollbar { height: 0; }

.nav-tab {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 20px; border-radius: var(--radius);
  font-family: var(--font-body); font-size: 12px; font-weight: 600;
  letter-spacing: 0.05em; white-space: nowrap;
  color: var(--ivory-mute); cursor: pointer;
  transition: all 0.3s var(--ease-luxury);
  border: 1px solid transparent;
  background: none;
}
.nav-tab:hover { color: var(--ivory-dim); background: rgba(255,255,255,0.03); }
.nav-tab.active {
  color: var(--gold-light);
  background: linear-gradient(135deg, rgba(201,150,43,0.1), rgba(139,105,20,0.06));
  border-color: rgba(201,150,43,0.2);
  box-shadow: inset 0 1px 0 rgba(212,175,112,0.1);
}
.nav-tab.active-slot {
  color: #E8CC94;
  background: linear-gradient(135deg, rgba(201,150,43,0.15), rgba(201,100,20,0.08));
  border-color: rgba(201,150,43,0.3);
}

/* â”€â”€â”€ INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.inp {
  width: 100%;
  background: var(--surface-1);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: var(--radius);
  padding: 10px 14px;
  font-family: var(--font-body); font-size: 13px;
  color: var(--ivory-dim);
  outline: none;
  transition: all 0.25s var(--ease-luxury);
}
.inp::placeholder { color: var(--ivory-ghost); }
.inp:focus {
  border-color: rgba(201,150,43,0.4);
  background: rgba(201,150,43,0.04);
  box-shadow: 0 0 0 3px rgba(201,150,43,0.06);
  color: var(--ivory);
}
select.inp option { background: #111520; color: var(--ivory-dim); }

.inp-label {
  display: block; margin-bottom: 7px;
  font-size: 10px; font-weight: 700;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: var(--ivory-mute);
}

/* â”€â”€â”€ SECTION HEADERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-head {
  padding: 18px 24px;
  border-bottom: 1px solid var(--rim);
  background: linear-gradient(135deg, rgba(201,150,43,0.05), transparent);
  display: flex; justify-content: space-between; align-items: center;
  gap: 12px; flex-wrap: wrap;
}
.section-title {
  font-family: var(--font-display);
  font-size: 17px; font-weight: 600;
  color: var(--ivory); letter-spacing: 0.02em;
  display: flex; align-items: center; gap: 10px;
}
.section-icon {
  width: 32px; height: 32px; border-radius: 8px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  background: rgba(201,150,43,0.1); color: var(--gold-mid);
  border: 1px solid rgba(201,150,43,0.15);
}

/* â”€â”€â”€ STAT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stat-card {
  background: var(--surface-2);
  border: 1px solid var(--rim);
  border-radius: var(--radius-lg);
  padding: 22px; position: relative; overflow: hidden;
  transition: all 0.3s var(--ease-luxury);
}
.stat-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
}
.stat-card:hover { transform: translateY(-2px); border-color: var(--rim-warm); }
.stat-card.gold::before  { background: linear-gradient(90deg, transparent, var(--gold), transparent); }
.stat-card.emerald::before { background: linear-gradient(90deg, transparent, var(--emerald-bright), transparent); }
.stat-card.rose::before  { background: linear-gradient(90deg, transparent, var(--rose-bright), transparent); }
.stat-card.sapphire::before { background: linear-gradient(90deg, transparent, var(--sapphire-bright), transparent); }

.stat-label {
  font-size: 10px; font-weight: 700; letter-spacing: 0.1em;
  text-transform: uppercase; color: var(--ivory-mute); margin-bottom: 10px;
}
.stat-value {
  font-family: var(--font-mono);
  font-size: 24px; font-weight: 500;
  color: var(--ivory); letter-spacing: -0.02em;
}

.stat-icon {
  width: 38px; height: 38px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
}
.stat-icon.gold    { background: rgba(201,150,43,0.1); color: var(--gold-mid); border: 1px solid rgba(201,150,43,0.15); }
.stat-icon.emerald { background: var(--emerald-glow); color: var(--emerald-bright); border: 1px solid rgba(34,201,135,0.15); }
.stat-icon.rose    { background: var(--rose-glow); color: var(--rose-bright); border: 1px solid rgba(240,107,124,0.15); }
.stat-icon.sapphire{ background: var(--sapphire-glow); color: var(--sapphire-bright); border: 1px solid rgba(91,143,232,0.15); }

/* â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.data-table { width: 100%; border-collapse: separate; border-spacing: 0; }
.data-table th {
  padding: 10px 16px; text-align: left;
  font-size: 10px; font-weight: 700; letter-spacing: 0.08em;
  text-transform: uppercase; color: var(--ivory-mute);
  background: rgba(8,10,14,0.5);
  border-bottom: 1px solid var(--rim);
}
.data-table td {
  padding: 13px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.025);
  transition: background 0.15s;
  font-size: 13px;
}
.data-table tr:hover td { background: rgba(201,150,43,0.03); }
.data-table tr:last-child td { border-bottom: none; }

/* â”€â”€â”€ REPORT OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#reportOutput {
  font-family: var(--font-mono);
  font-size: 12px; line-height: 2;
  color: var(--ivory-dim);
  white-space: pre-wrap;
  letter-spacing: 0.02em;
}

/* â”€â”€â”€ DROP ZONE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.drop-zone {
  border: 1px dashed rgba(201,150,43,0.2);
  border-radius: var(--radius);
  transition: all 0.25s var(--ease-luxury);
}
.drop-zone:hover, .drop-zone.active {
  border-color: rgba(201,150,43,0.45);
  background: rgba(201,150,43,0.03);
}
.drop-zone textarea {
  background: transparent;
  border: none; outline: none;
  width: 100%; height: 130px;
  padding: 14px 16px;
  font-family: var(--font-mono); font-size: 11px;
  color: var(--ivory-dim); resize: none;
  letter-spacing: 0.02em; line-height: 1.7;
  display: block;
}
.drop-zone textarea::placeholder { color: var(--ivory-ghost); }

/* â”€â”€â”€ PROVIDER ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prov-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 11px 14px; border-radius: var(--radius);
  margin-bottom: 5px; border: 1px solid var(--rim);
  background: rgba(8,10,14,0.4);
  transition: all 0.2s var(--ease-luxury);
}
.prov-row:hover { background: rgba(201,150,43,0.04); border-color: rgba(201,150,43,0.12); }
.prov-row.gold {
  background: linear-gradient(135deg, rgba(201,150,43,0.07), rgba(139,105,20,0.04));
  border-color: rgba(201,150,43,0.22);
}
.prov-row.gold:hover { background: linear-gradient(135deg, rgba(201,150,43,0.12), rgba(139,105,20,0.07)); }

/* Provider input inside row */
.prov-inp {
  width: 140px;
  background: rgba(8,10,14,0.6);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: var(--radius-sm);
  padding: 7px 12px;
  font-family: var(--font-mono); font-size: 12px;
  color: var(--ivory-dim); text-align: right; outline: none;
  transition: all 0.2s var(--ease-luxury);
}
.prov-inp.gold-inp {
  border-color: rgba(201,150,43,0.18);
  background: rgba(201,150,43,0.05);
}
.prov-inp:focus {
  border-color: rgba(201,150,43,0.4);
  color: var(--ivory);
  box-shadow: 0 0 0 2px rgba(201,150,43,0.07);
}

/* â”€â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider {
  height: 1px; margin: 16px 0;
  background: linear-gradient(90deg, transparent, var(--rim), transparent);
}
.divider-gold {
  background: linear-gradient(90deg, transparent, rgba(201,150,43,0.2), transparent);
}

/* â”€â”€â”€ ELIGIBLE STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.eligible-yes {
  background: linear-gradient(135deg, rgba(15,92,66,0.2), rgba(10,50,35,0.15));
  border: 1px solid rgba(34,201,135,0.2);
  border-radius: var(--radius);
  padding: 14px 18px;
}
.eligible-no {
  background: linear-gradient(135deg, rgba(154,46,63,0.15), rgba(90,20,30,0.1));
  border: 1px solid rgba(240,107,124,0.2);
  border-radius: var(--radius);
  padding: 14px 18px;
}

/* â”€â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prog-bar { height: 3px; background: rgba(255,255,255,0.05); border-radius: 2px; overflow: hidden; }
.prog-fill { height: 100%; border-radius: 2px; transition: width 0.8s var(--ease-luxury); }

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast {
  position: fixed; bottom: 28px; right: 28px; z-index: 9999;
  background: linear-gradient(145deg, var(--surface-3), var(--surface-2));
  border: 1px solid rgba(201,150,43,0.2);
  border-radius: 14px; padding: 14px 20px;
  display: flex; align-items: center; gap: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.7), 0 0 0 1px rgba(201,150,43,0.05);
  transform: translateY(120px); opacity: 0;
  transition: all 0.4s var(--ease-luxury);
  min-width: 260px; max-width: 360px;
}
#toast.show { transform: translateY(0); opacity: 1; }
#toastTitle { font-weight: 700; font-size: 13px; color: var(--ivory); }
#toastMessage { font-size: 11px; color: var(--ivory-mute); margin-top: 2px; }

/* â”€â”€â”€ RESULT CARD TOTAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.total-display {
  font-family: var(--font-display);
  font-size: 42px; font-weight: 600; font-style: italic;
  background: linear-gradient(135deg, var(--gold-mid), var(--gold-light), var(--gold-pale));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; line-height: 1;
  letter-spacing: -0.01em;
}

/* â”€â”€â”€ RANK ITEMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rank-medal {
  width: 24px; height: 24px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 800; flex-shrink: 0;
}

/* â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(201,150,43,0.2); border-radius: 2px; }
::-webkit-scrollbar-thumb:hover { background: rgba(201,150,43,0.4); }

/* â”€â”€â”€ ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.fade-in { animation: fadeUp 0.45s var(--ease-luxury) both; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}

.stagger-1 { animation-delay: 0.05s; }
.stagger-2 { animation-delay: 0.1s; }
.stagger-3 { animation-delay: 0.15s; }
.stagger-4 { animation-delay: 0.2s; }

/* â”€â”€â”€ UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.text-gold    { color: var(--gold-mid); }
.text-ivory   { color: var(--ivory); }
.text-muted   { color: var(--ivory-mute); }
.text-emerald { color: var(--emerald-bright); }
.text-rose    { color: var(--rose-bright); }
.text-sapphire{ color: var(--sapphire-bright); }
.mono         { font-family: var(--font-mono); }
.display      { font-family: var(--font-display); }
.hidden       { display: none !important; }
.w-full       { width: 100%; }
.flex         { display: flex; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.gap-2 { gap: 8px; }
.gap-3 { gap: 12px; }
.gap-4 { gap: 16px; }
.flex-wrap    { flex-wrap: wrap; }

@media print {
  .no-print, nav { display: none !important; }
  body, .panel { background: white !important; color: black !important; }
  .bg-canvas, .bg-grid, .bg-grain { display: none; }
}
</style>
</head>
<body>

<!-- Background layers -->
<div class="bg-canvas">
  <div class="bg-halo halo-gold"></div>
  <div class="bg-halo halo-ember"></div>
  <div class="bg-halo halo-cool"></div>
</div>
<div class="bg-grid"></div>
<div class="bg-grain"></div>

<div class="shell">

  <!-- â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="header fade-in">
    <div class="header-brand">
      <div class="brand-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="rgba(255,240,200,0.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><line x1="3" x2="21" y1="9" y2="9"/><path d="m9 16 3-3 3 3"/></svg>
      </div>
      <div>
        <div class="brand-title">TVTOTO <em>WINLOSE</em></div>
        <div class="brand-sub">
          <span class="badge badge-emerald">PNG</span>
          <span style="font-size:11px; color:var(--ivory-mute); letter-spacing:0.04em;">Â· Auto-Save Â· Slot Bonus Module</span>
        </div>
      </div>
    </div>
    <div class="flex gap-2 flex-wrap no-print">
      <button onclick="exportData()" class="btn btn-ghost" style="font-size:11px; padding:8px 14px;">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        Backup
      </button>
      <label class="btn btn-ghost" style="font-size:11px; padding:8px 14px; cursor:pointer;">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
        Restore
        <input type="file" id="importFile" style="display:none;" accept=".json" onchange="importData(this)">
      </label>
      <button onclick="clearAllData()" class="btn btn-danger" style="font-size:11px; padding:8px 14px;">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
        Reset
      </button>
    </div>
  </header>

  <!-- â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="nav-wrap no-print fade-in stagger-1">
    <button id="dashboardTab" class="nav-tab" onclick="switchTab('dashboard')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
      Dashboard
    </button>
    <button id="winlossTab" class="nav-tab active" onclick="switchTab('winloss')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      Winloss Input
    </button>
    <button id="bonusTab" class="nav-tab" onclick="switchTab('bonus')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      Bonus Calculator
    </button>
    <button id="slotBonusTab" class="nav-tab active-slot" onclick="switchTab('slotBonus')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
      Perhitungan Bonus Slot
    </button>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- DASHBOARD                                  -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main id="dashboardContent" class="hidden fade-in">
    <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:14px; margin-bottom:18px;">
      <div class="stat-card gold stagger-1 fade-in">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
          <div>
            <p class="stat-label">Total Turnover</p>
            <p id="dashTurnover" class="stat-value">0</p>
          </div>
          <div class="stat-icon gold">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
          </div>
        </div>
      </div>
      <div class="stat-card rose stagger-2 fade-in">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
          <div>
            <p class="stat-label">Total Loss</p>
            <p id="dashLoss" class="stat-value">0</p>
          </div>
          <div class="stat-icon rose">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>
          </div>
        </div>
      </div>
      <div class="stat-card emerald stagger-3 fade-in">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
          <div>
            <p class="stat-label">Bonus Distributed</p>
            <p id="dashBonus" class="stat-value">0</p>
          </div>
          <div class="stat-icon emerald">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
          </div>
        </div>
      </div>
      <div class="stat-card sapphire stagger-4 fade-in">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
          <div>
            <p class="stat-label">Slot Bonus Sessions</p>
            <p id="dashSlotSessions" class="stat-value">0</p>
          </div>
          <div class="stat-icon sapphire">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
          </div>
        </div>
      </div>
    </div>

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;">
      <div class="panel-accented" style="padding:24px;">
        <h3 style="font-family:var(--font-display); font-size:15px; font-weight:600; color:var(--ivory); margin-bottom:18px; letter-spacing:0.02em;">Distribusi per Kategori</h3>
        <div style="height:210px; display:flex; justify-content:center;"><canvas id="categoryChart"></canvas></div>
      </div>
      <div class="panel-accented" style="padding:24px;">
        <h3 style="font-family:var(--font-display); font-size:15px; font-weight:600; color:var(--ivory); margin-bottom:18px; letter-spacing:0.02em;">Riwayat Bonus</h3>
        <div style="height:210px;"><canvas id="bonusChart"></canvas></div>
      </div>
    </div>

    <div class="panel" style="overflow:hidden;">
      <div style="padding:14px 20px; border-bottom:1px solid var(--rim);">
        <h3 style="font-family:var(--font-display); font-size:15px; font-weight:600; color:var(--ivory); letter-spacing:0.02em;">Aktivitas Terakhir</h3>
      </div>
      <table class="data-table">
        <thead><tr><th>Waktu</th><th>Tipe</th><th>Detail</th><th style="text-align:right;">Jumlah</th></tr></thead>
        <tbody id="activityLogTable"><tr><td colspan="4" style="text-align:center; color:var(--ivory-mute); padding:28px; font-size:12px;">Belum ada aktivitas</td></tr></tbody>
      </table>
    </div>
  </main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- WINLOSS INPUT                              -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main id="winlossContent" style="display:grid; grid-template-columns:1fr 1fr; gap:18px;" class="fade-in">

    <!-- Input form -->
    <section>
      <div class="panel-accented" style="overflow:hidden;">
        <div class="section-head">
          <div class="section-title">
            <div class="section-icon">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
            </div>
            Input Data Winloss
          </div>
          <span class="badge badge-sapphire">Smart Parser</span>
        </div>

        <div style="padding:22px; display:flex; flex-direction:column; gap:16px;">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
            <div>
              <label class="inp-label">Kategori</label>
              <select id="categorySelect" class="inp" onchange="handleCategoryChange()">
                <option value="SLOT">Slot Games</option>
                <option value="LIVEGAME">Live Games</option>
                <option value="SPORT">Sportsbook</option>
              </select>
            </div>
            <div>
              <label class="inp-label">Provider</label>
              <select id="providerSelect" class="inp"><option value="">Pilih Providerâ€¦</option></select>
            </div>
          </div>

          <div>
            <label class="inp-label">Periode Laporan</label>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <input type="date" id="startDate" class="inp" onchange="handleDateChange()">
              <input type="date" id="endDate" class="inp" onchange="handleDateChange()">
            </div>
          </div>

          <div style="background:rgba(154,46,63,0.08); border:1px solid rgba(154,46,63,0.2); border-radius:var(--radius); padding:14px; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <div>
              <p style="font-size:12px; font-weight:600; color:var(--rose-bright);">Threshold Loss</p>
              <p style="font-size:10px; color:var(--ivory-mute); margin-top:2px;">Hanya data di bawah nilai ini</p>
            </div>
            <div style="position:relative; width:160px;">
              <span style="position:absolute; left:12px; top:50%; transform:translateY(-50%); font-size:11px; color:var(--ivory-mute); font-family:var(--font-mono);">Rp</span>
              <input type="number" id="thresholdInput" value="-100000" class="inp mono" style="padding-left:30px; font-size:12px;">
            </div>
          </div>

          <div>
            <label class="inp-label">Paste Data Excel / CSV</label>
            <div id="dropZone" class="drop-zone">
              <textarea id="dataInput" placeholder="Paste data di siniâ€¦ (Tab atau Comma separated)&#10;&#10;Contoh:&#10;UserID    Win    Loss&#10;TEST01    100000    -500000"></textarea>
            </div>
          </div>

          <button onclick="processData()" class="btn btn-gold btn-lg btn-full">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
            Proses Data
          </button>
        </div>
      </div>
    </section>

    <!-- Preview -->
    <section>
      <div class="panel-accented" style="overflow:hidden; position:sticky; top:20px;">
        <div class="section-head">
          <div class="section-title">
            <div class="section-icon">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/></svg>
            </div>
            Preview Laporan
          </div>
          <div class="flex gap-2">
            <button onclick="copyToClipboard()" class="btn btn-ghost" style="font-size:11px; padding:7px 13px;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
              Salin
            </button>
            <button onclick="window.print()" class="btn btn-ghost" style="font-size:11px; padding:7px 13px;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></svg>
              Print
            </button>
          </div>
        </div>
        <div style="padding:26px; background:var(--void); min-height:360px; max-height:520px; overflow-y:auto;">
          <div id="reportOutput"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- BONUS CALCULATOR                           -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="bonusContent" class="hidden fade-in" style="display:none; grid-template-columns:340px 1fr; gap:18px;">
    <div>
      <div class="panel-accented" style="overflow:hidden;">
        <div class="section-head">
          <div class="section-title">
            <div class="section-icon">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            Kalkulator Bonus
          </div>
        </div>
        <div style="padding:22px; display:flex; flex-direction:column; gap:14px;">
          <div>
            <label class="inp-label">User ID</label>
            <div style="position:relative;">
              <span style="position:absolute; left:13px; top:50%; transform:translateY(-50%); color:var(--ivory-mute); font-size:13px;">@</span>
              <input type="text" id="userIdInput" placeholder="member123" class="inp" style="padding-left:30px;">
            </div>
          </div>
          <div>
            <label class="inp-label">Periode Bonus</label>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
              <input type="date" id="bonusStartDate" class="inp" style="font-size:12px;">
              <input type="date" id="bonusEndDate" class="inp" style="font-size:12px;">
            </div>
          </div>
          <button onclick="importFromWinloss()" style="width:100%; padding:10px; background:rgba(201,150,43,0.08); border:1px solid rgba(201,150,43,0.18); border-radius:var(--radius); color:var(--gold-mid); font-size:12px; font-weight:600; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:6px; transition:all 0.25s; font-family:var(--font-body);" onmouseover="this.style.background='rgba(201,150,43,0.14)'" onmouseout="this.style.background='rgba(201,150,43,0.08)'">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Import dari Winloss Tab
          </button>
          <div class="divider"></div>
          <div>
            <p style="font-size:10px; font-weight:700; color:var(--sapphire-bright); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:7px;">Livegame / Sport</p>
            <p style="font-size:10px; color:var(--ivory-mute); margin-bottom:6px;">Rate: 2.5% â€“ 5%</p>
            <input type="number" id="livegameLoss" placeholder="0" class="inp mono" style="font-size:13px;">
          </div>
          <div>
            <p style="font-size:10px; font-weight:700; color:var(--gold-mid); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:7px;">Slot</p>
            <p style="font-size:10px; color:var(--ivory-mute); margin-bottom:6px;">Rate: 5% flat</p>
            <input type="number" id="slotLoss" placeholder="0" class="inp mono" style="font-size:13px;">
          </div>
          <button onclick="calculateBonus()" class="btn btn-emerald btn-lg btn-full" style="margin-top:4px;">Hitung Bonus</button>
        </div>
      </div>
    </div>

    <div style="display:flex; flex-direction:column; gap:16px;">
      <div class="panel" style="padding:28px; min-height:200px; display:flex; flex-direction:column; justify-content:center; align-items:center;" id="bonusResultCard">
        <div id="bonusOutput" style="width:100%; text-align:center; color:var(--ivory-mute); font-size:13px;">Hasil perhitungan bonus akan muncul di sini</div>
      </div>
      <div class="panel" style="overflow:hidden;">
        <div style="padding:14px 20px; border-bottom:1px solid var(--rim); display:flex; justify-content:space-between; align-items:center;">
          <h3 style="font-family:var(--font-display); font-size:15px; font-weight:600; color:var(--ivory); letter-spacing:0.02em;">Riwayat Bonus</h3>
          <span id="bonusCountBadge" class="badge badge-ivory">0 Data</span>
        </div>
        <div style="overflow-x:auto; max-height:360px; overflow-y:auto;">
          <table class="data-table">
            <thead><tr><th>User ID</th><th>Tgl</th><th style="text-align:right;">Loss</th><th style="text-align:right;">Bonus</th><th style="text-align:center;">Aksi</th></tr></thead>
            <tbody id="bonusHistoryTable"><tr><td colspan="5" style="text-align:center; color:var(--ivory-mute); padding:28px; font-size:12px;">Belum ada riwayat</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SLOT BONUS MODULE                          -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="slotBonusContent" class="hidden fade-in" style="display:none;">

    <!-- Module header -->
    <div class="panel-gold" style="padding:22px 28px; margin-bottom:20px; display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; gap:16px; position:relative; overflow:hidden;">
      <div style="position:absolute; top:-60px; right:-60px; width:200px; height:200px; background:radial-gradient(circle, rgba(201,150,43,0.1) 0%, transparent 70%); pointer-events:none;"></div>
      <div style="display:flex; align-items:center; gap:18px;">
        <div style="width:54px; height:54px; background:linear-gradient(145deg, var(--gold-deep), var(--gold)); border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:22px; box-shadow:0 8px 32px rgba(201,150,43,0.3), 0 0 0 1px rgba(201,150,43,0.25);">ðŸŽ°</div>
        <div>
          <h2 style="font-family:var(--font-display); font-size:22px; font-weight:600; color:var(--ivory); letter-spacing:0.02em;">Perhitungan Bonus Slot</h2>
          <p style="font-size:11px; color:var(--gold-mid); margin-top:5px; letter-spacing:0.04em;">Provider Group Logic Â· Anti Double-Count Â· Auto Ranking</p>
        </div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <span class="badge badge-gold">Group System</span>
        <span class="badge badge-emerald">Anti Double-Count</span>
      </div>
    </div>

    <div style="display:grid; grid-template-columns:320px 1fr; gap:18px; align-items:start;">

      <!-- Left panel -->
      <div style="display:flex; flex-direction:column; gap:14px;">

        <!-- Session config -->
        <div class="panel-accented" style="overflow:hidden;">
          <div class="section-head" style="padding:14px 20px;">
            <div class="section-title" style="font-size:14px;">
              <div class="section-icon" style="width:28px; height:28px;">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 0 1 1.77 11.09 10 10 0 0 1-9.07 5.98 10 10 0 0 1-9.07-5.98A10 10 0 0 1 4.93 4.93"/></svg>
              </div>
              Konfigurasi Sesi
            </div>
          </div>
          <div style="padding:18px; display:flex; flex-direction:column; gap:13px;">
            <div>
              <label class="inp-label">User ID</label>
              <div style="position:relative;">
                <span style="position:absolute; left:13px; top:50%; transform:translateY(-50%); color:var(--ivory-mute);">@</span>
                <input type="text" id="sbUserId" placeholder="member123" class="inp" style="padding-left:30px;">
              </div>
            </div>
            <div>
              <label class="inp-label">Periode</label>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <input type="date" id="sbStartDate" class="inp" style="font-size:11px;">
                <input type="date" id="sbEndDate" class="inp" style="font-size:11px;">
              </div>
            </div>
            <div>
              <label class="inp-label">Filter Cepat</label>
              <select id="sbPeriodFilter" class="inp" style="font-size:12px;" onchange="applySbPeriodFilter()">
                <option value="custom">Custom</option>
                <option value="today">Hari Ini</option>
                <option value="week">Minggu Ini</option>
                <option value="month">Bulan Ini</option>
              </select>
            </div>
            <div>
              <label class="inp-label">Min. Turnover Eligible</label>
              <div style="position:relative;">
                <span style="position:absolute; left:13px; top:50%; transform:translateY(-50%); font-size:10px; color:var(--ivory-mute); font-family:var(--font-mono);">Rp</span>
                <input type="number" id="sbMinTurnover" value="1000000" class="inp mono" style="padding-left:30px; font-size:12px;">
              </div>
            </div>
          </div>
        </div>

        <!-- Bonus % settings -->
        <div class="panel-accented" style="overflow:hidden;">
          <div class="section-head" style="padding:14px 20px;">
            <div class="section-title" style="font-size:14px;">
              <div class="section-icon" style="width:28px; height:28px; font-size:12px; font-weight:700; font-family:var(--font-mono);">%</div>
              Setting Persentase
            </div>
            <span class="badge badge-gold" style="font-size:9px;">Admin</span>
          </div>
          <div style="padding:18px; display:flex; flex-direction:column; gap:14px;">
            <div>
              <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                <label style="font-size:10px; font-weight:700; color:var(--gold-mid); text-transform:uppercase; letter-spacing:0.08em;">Gold Group</label>
                <span id="sbGroupPctDisplay" class="mono" style="font-size:13px; font-weight:600; color:var(--gold-light);">5%</span>
              </div>
              <div style="display:flex; align-items:center; gap:10px;">
                <input type="range" id="sbGroupPct" min="0" max="20" step="0.5" value="5" oninput="updateSbPctDisplays()" style="flex:1; accent-color:var(--gold); height:3px; cursor:pointer;">
                <input type="number" id="sbGroupPctNum" value="5" min="0" max="20" step="0.5" oninput="syncSbPct('group')" class="inp mono" style="width:60px; padding:6px 10px; font-size:12px;">
              </div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                <label style="font-size:10px; font-weight:700; color:var(--ivory-dim); text-transform:uppercase; letter-spacing:0.08em;">Provider Normal</label>
                <span id="sbNormalPctDisplay" class="mono" style="font-size:13px; font-weight:600; color:var(--ivory-dim);">5%</span>
              </div>
              <div style="display:flex; align-items:center; gap:10px;">
                <input type="range" id="sbNormalPct" min="0" max="20" step="0.5" value="5" oninput="updateSbPctDisplays()" style="flex:1; accent-color:var(--sapphire-bright); height:3px; cursor:pointer;">
                <input type="number" id="sbNormalPctNum" value="5" min="0" max="20" step="0.5" oninput="syncSbPct('normal')" class="inp mono" style="width:60px; padding:6px 10px; font-size:12px;">
              </div>
            </div>
            <div style="background:var(--gold-glow2); border:1px solid var(--rim-warm); border-radius:var(--radius); padding:10px 13px; font-size:10px; color:var(--gold-mid); line-height:1.6;">
              âš¡ Gold Group terhitung sebagai <strong style="color:var(--gold-light);">1 kategori bonus</strong> â€” tidak ada double count meski player bermain di beberapa provider dalam grup.
            </div>
          </div>
        </div>

        <!-- Gold group info -->
        <div class="panel-gold" style="padding:18px;">
          <h4 style="font-size:10px; font-weight:700; color:var(--gold-mid); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:12px; display:flex; align-items:center; gap:6px;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            Gold Group Providers
          </h4>
          <div id="sbGroupProviderList"></div>
          <div class="divider divider-gold"></div>
          <p style="font-size:10px; color:var(--ivory-mute); line-height:1.6;">Semua provider di atas dihitung sebagai <em style="color:var(--gold-mid);">satu unit bonus</em>. Turnover digabung, dihitung 1x bonus saja.</p>
        </div>
      </div>

      <!-- Right panel -->
      <div style="display:flex; flex-direction:column; gap:14px;">

        <!-- Provider inputs -->
        <div class="panel-accented" style="overflow:hidden;">
          <div class="section-head">
            <div class="section-title" style="font-size:14px;">
              ðŸŽ® Input Turnover per Provider
            </div>
            <button onclick="resetSbInputs()" class="btn btn-ghost" style="font-size:11px; padding:6px 12px;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
              Reset
            </button>
          </div>
          <div style="padding:20px;">

            <!-- Gold group inputs -->
            <div style="margin-bottom:18px;">
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
                <div style="width:7px; height:7px; border-radius:50%; background:var(--gold); box-shadow:0 0 8px var(--gold);"></div>
                <span style="font-size:10px; font-weight:700; color:var(--gold-mid); text-transform:uppercase; letter-spacing:0.08em;">Gold Group Providers</span>
                <span class="badge badge-gold" style="font-size:9px;">1Ã— Bonus</span>
              </div>
              <div id="sbGroupInputs"></div>
            </div>

            <div class="divider divider-gold"></div>

            <!-- Normal inputs -->
            <div>
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
                <div style="width:7px; height:7px; border-radius:50%; background:var(--sapphire-bright);"></div>
                <span style="font-size:10px; font-weight:700; color:var(--ivory-dim); text-transform:uppercase; letter-spacing:0.08em;">Provider Normal</span>
                <span class="badge badge-sapphire" style="font-size:9px;">Individual Bonus</span>
              </div>
              <div id="sbNormalInputs"></div>
            </div>

            <div style="display:flex; gap:10px; margin-top:20px;">
              <button onclick="calculateSlotBonus()" class="btn btn-gold btn-lg" style="flex:1; justify-content:center;">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                Hitung Bonus Slot
              </button>
              <button onclick="generateSlotReport()" class="btn btn-ghost" style="padding:13px 16px;" title="Generate Report">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/></svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Result panel -->
        <div id="sbResultPanel" class="panel-accented" style="overflow:hidden; display:none;">
          <div class="section-head">
            <div class="section-title" style="font-size:14px;">ðŸ“Š Hasil Perhitungan</div>
            <button onclick="exportSlotBonusPDF()" class="btn btn-ghost" style="font-size:11px; padding:7px 13px;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
              Export PDF
            </button>
          </div>
          <div id="sbResultContent" style="padding:22px;"></div>
        </div>

        <!-- Report text -->
        <div id="sbReportPanel" class="panel" style="overflow:hidden; display:none;">
          <div style="padding:14px 20px; border-bottom:1px solid var(--rim); display:flex; justify-content:space-between; align-items:center;">
            <h3 style="font-family:var(--font-display); font-size:14px; font-weight:600; color:var(--ivory);">Generate Report</h3>
            <button onclick="copySbReport()" class="btn btn-ghost" style="font-size:11px; padding:6px 12px;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
              Copy
            </button>
          </div>
          <div style="padding:18px; background:var(--void);">
            <textarea id="sbReportOutput" readonly class="mono" style="width:100%; height:190px; background:transparent; color:var(--ivory-dim); font-size:11px; line-height:1.9; resize:none; outline:none; border:none;"></textarea>
          </div>
        </div>

        <!-- History -->
        <div class="panel" style="overflow:hidden;">
          <div style="padding:14px 20px; border-bottom:1px solid var(--rim); display:flex; justify-content:space-between; align-items:center;">
            <h3 style="font-family:var(--font-display); font-size:15px; font-weight:600; color:var(--ivory); letter-spacing:0.02em;">Riwayat Perhitungan Slot</h3>
            <div style="display:flex; gap:8px; align-items:center;">
              <span id="sbHistoryCountBadge" class="badge badge-gold">0 Session</span>
              <button onclick="clearSbHistory()" class="btn btn-danger" style="font-size:10px; padding:5px 10px;">Hapus</button>
            </div>
          </div>
          <div style="overflow-x:auto; max-height:300px; overflow-y:auto;">
            <table class="data-table">
              <thead><tr><th>User</th><th>Tgl</th><th style="text-align:right;">Turnover</th><th style="text-align:right;">Group Bonus</th><th style="text-align:right;">Normal</th><th style="text-align:right;">Total</th><th>Status</th><th style="text-align:center;">Aksi</th></tr></thead>
              <tbody id="sbHistoryTable"><tr><td colspan="8" style="text-align:center; color:var(--ivory-mute); padding:28px; font-size:12px;">Belum ada riwayat</td></tr></tbody>
            </table>
          </div>
        </div>

        <!-- Ranking -->
        <div class="panel" style="overflow:hidden;">
          <div style="padding:14px 20px; border-bottom:1px solid var(--rim);">
            <h3 style="font-family:var(--font-display); font-size:15px; font-weight:600; color:var(--ivory); letter-spacing:0.02em;">ðŸ† Auto Ranking Provider</h3>
          </div>
          <div id="sbRankingContent" style="padding:20px;">
            <p style="color:var(--ivory-mute); font-size:12px; text-align:center;">Hitung bonus untuk melihat ranking</p>
          </div>
        </div>

      </div>
    </div>
  </div>

</div><!-- /shell -->

<!-- Toast -->
<div id="toast">
  <div id="toastIcon"></div>
  <div>
    <div id="toastTitle"></div>
    <div id="toastMessage"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- ALL JAVASCRIPT â€” FULLY PRESERVED           -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// ============================================
// ORIGINAL CONFIG & DATA (PRESERVED INTACT)
// ============================================
const PROVIDERS = {
    SLOT: ["5G", "ASK SLOT", "RED TIGER,NOLIMITCITY,NETENT,BIGTIMEGAMING", "FatPanda", "GGSoft", "HABANERO", "HACKSAW", "JILI SLOT", "JOKER SLOT", "Liteplay", "PG", "Playtech", "Playstar", "PNG SLOT", "PRAGMATIC PLAY SLOT", "WMC", "WowGaming"],
    LIVEGAME: ["BG", "Empire Gaming", "EVOLUTION", "Jmarble", "PNG LIVE", "PRAGMATIC PLAY LIVE", "RGCASINO", "SA GAMING", "SEXYGAMING", "TGION", "EEAI"],
    SPORT: ["AP", "CMD368 SPORTS", "SBO", "TF", "XJ"]
};

let state = {
    winlossData: {},
    bonusHistory: [],
    activityLog: [],
    slotBonusHistory: [],
    lastUpdated: null
};

let charts = { category: null, bonus: null };

// ============================================
// NEW: SLOT BONUS MODULE CONFIG
// ============================================
const SB_PROVIDER_GROUPS = {
    "GOLD_GROUP": {
        label: "Gold Group",
        color: "#C9962B",
        providers: ["RED TIGER", "NOLIMITCITY", "NETENT", "BIGTIMEGAMING"]
    }
};

const SB_ALL_GROUPS_FLAT = Object.values(SB_PROVIDER_GROUPS).flatMap(g => g.providers);
const SB_NORMAL_PROVIDERS = PROVIDERS.SLOT.filter(p => !SB_ALL_GROUPS_FLAT.includes(p));

function getSbProviderGroup(providerName) {
    for (const [key, group] of Object.entries(SB_PROVIDER_GROUPS)) {
        if (group.providers.includes(providerName)) return { key, ...group };
    }
    return null;
}

let lastSbResult = null;

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    loadData();
    initCharts();
    setupDragDrop();
    handleCategoryChange();
    
    const today = new Date().toISOString().split('T')[0];
    ['startDate','endDate','bonusStartDate','bonusEndDate','sbStartDate','sbEndDate'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = today;
    });

    buildSbProviderInputs();
    renderSbGroupProviderList();
    updateSbPctDisplays();
    updateUI();

    // Correct initial tab display
    document.getElementById('dashboardContent').style.display = 'none';
    document.getElementById('bonusContent').style.display = 'none';
    document.getElementById('slotBonusContent').style.display = 'none';
    document.getElementById('winlossContent').style.display = 'grid';
});

// ============================================
// ORIGINAL LOGIC (PRESERVED)
// ============================================
function saveData() {
    state.lastUpdated = new Date().toISOString();
    localStorage.setItem('winlossCalcProData_v5', JSON.stringify(state));
}

function loadData() {
    const saved = localStorage.getItem('winlossCalcProData_v5') || localStorage.getItem('winlossCalcProData');
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            state = { ...state, ...parsed };
            if (!state.slotBonusHistory) state.slotBonusHistory = [];
        } catch(e) { console.error('Load error', e); }
    }
}

function switchTab(tabId) {
    const tabs = ['dashboard', 'winloss', 'bonus', 'slotBonus'];
    tabs.forEach(t => {
        const el = document.getElementById(t + 'Content');
        const btn = document.getElementById(t + 'Tab');
        if (!el || !btn) return;
        if (t === tabId) {
            el.style.display = t === 'winloss' ? 'grid' : t === 'bonus' ? 'grid' : '';
            el.classList.remove('hidden');
            btn.classList.add(t === 'slotBonus' ? 'active-slot' : 'active');
        } else {
            el.style.display = 'none';
            el.classList.add('hidden');
            btn.classList.remove('active', 'active-slot');
        }
    });
    if (tabId === 'dashboard') updateCharts();
}

function handleCategoryChange() {
    const cat = document.getElementById('categorySelect').value;
    const prov = document.getElementById('providerSelect');
    prov.innerHTML = '<option value="">Pilih Providerâ€¦</option>';
    (PROVIDERS[cat] || []).forEach(p => {
        const opt = document.createElement('option');
        opt.value = p; opt.text = p;
        prov.appendChild(opt);
    });
}

function handleDateChange() {
    const s = document.getElementById('startDate');
    const e = document.getElementById('endDate');
    if (s.value && e.value && s.value > e.value) {
        e.value = s.value;
        showToast('Info', 'Tanggal akhir disesuaikan', 'info');
    }
    updateReportPreview();
}

function processData() {
    const cat = document.getElementById('categorySelect').value;
    const prov = document.getElementById('providerSelect').value;
    const threshold = parseFloat(document.getElementById('thresholdInput').value) || 0;
    const raw = document.getElementById('dataInput').value;

    if (!prov) return showToast('Error', 'Pilih Kategori & Provider', 'error');
    if (!raw.trim()) return showToast('Error', 'Data Excel kosong', 'error');

    const sep = raw.includes('\t') ? '\t' : ',';
    const rows = raw.split(/\r?\n/);
    let totalLoss = 0, rowCount = 0;

    rows.forEach(row => {
        const cols = row.split(sep);
        if (cols.length > 2) {
            const val = parseFloat(cols[2].replace(/[^0-9.-]/g, ''));
            if (!isNaN(val) && val <= threshold) { totalLoss += val; rowCount++; }
        }
    });

    if (rowCount === 0) return showToast('Info', `Tidak ada data â‰¤ ${threshold}`, 'info');

    if (!state.winlossData[cat]) state.winlossData[cat] = {};
    state.winlossData[cat][prov] = (state.winlossData[cat][prov] || 0) + totalLoss;

    logActivity('WINLOSS', `${cat} â€” ${prov}`, totalLoss);
    saveData(); updateUI();
    document.getElementById('dataInput').value = '';
    showToast('Sukses', `${rowCount} data diproses Â· Total: ${fc(totalLoss)}`);
}

function calculateBonus() {
    const userId = document.getElementById('userIdInput').value;
    if (!userId) return showToast('Error', 'Masukkan User ID', 'error');

    const liveLoss = parseFloat(document.getElementById('livegameLoss').value) || 0;
    const slotLoss = parseFloat(document.getElementById('slotLoss').value) || 0;

    let liveBonus = 0;
    if (liveLoss >= 100000 && liveLoss <= 250000000) liveBonus = liveLoss * 0.025;
    else if (liveLoss > 250000000) liveBonus = liveLoss * 0.05;
    const slotBonus = slotLoss * 0.05;
    const totalBonus = liveBonus + slotBonus;

    const record = { id: Date.now(), userId, date: document.getElementById('bonusStartDate').value, liveLoss, slotLoss, liveBonus, slotBonus, totalBonus };
    state.bonusHistory.push(record);
    logActivity('BONUS', `User: ${userId}`, totalBonus);
    saveData(); updateUI();
    showToast('Berhasil', `Bonus ${fc(totalBonus)} dihitung`);
}

function importFromWinloss() {
    let totalLive = 0, totalSlot = 0;
    if (state.winlossData['LIVEGAME']) Object.values(state.winlossData['LIVEGAME']).forEach(v => totalLive += Math.abs(v));
    if (state.winlossData['SPORT']) Object.values(state.winlossData['SPORT']).forEach(v => totalLive += Math.abs(v));
    if (state.winlossData['SLOT']) Object.values(state.winlossData['SLOT']).forEach(v => totalSlot += Math.abs(v));
    document.getElementById('livegameLoss').value = totalLive;
    document.getElementById('slotLoss').value = totalSlot;
    showToast('Import', 'Data Winloss berhasil diambil');
}

// ============================================
// UI UPDATERS
// ============================================
function updateUI() {
    updateReportPreview();
    updateBonusHistory();
    updateDashboardStats();
    updateActivityLog();
    updateSbHistory();
}

function updateReportPreview() {
    const output = document.getElementById('reportOutput');
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    const fDate = (ds) => {
        if (!ds) return '';
        const d = new Date(ds);
        return `${d.getDate()} ${d.toLocaleDateString('id-ID',{month:'short'})}`;
    };

    const toBold = (str) => str.split('').map(c => {
        if (c >= 'A' && c <= 'Z') return String.fromCodePoint(0x1D400 + c.charCodeAt(0) - 65);
        if (c >= 'a' && c <= 'z') return String.fromCodePoint(0x1D41A + c.charCodeAt(0) - 97);
        if (c >= '0' && c <= '9') return String.fromCodePoint(0x1D7CE + c.charCodeAt(0) - 48);
        return c;
    }).join('');

    let text = `${toBold("Bonus Winlose Periode")} ${fDate(startDate)} - ${fDate(endDate)}\n\n`;
    const order = ["LIVEGAME", "SPORT", "SLOT"];

    order.forEach(cat => {
        const catData = state.winlossData[cat];
        text += `${toBold(cat)}\n`;
        let catTotal = 0;
        (PROVIDERS[cat] || []).forEach(p => {
            const val = catData?.[p] || 0;
            if (val !== 0) { text += `${p} : ${fc(val)}\n`; catTotal += val; }
        });
        text += `\nTOTAL :   ${toBold(fc(catTotal))}\n\n`;
    });

    output.innerText = text;
}

function updateBonusHistory() {
    const tbody = document.getElementById('bonusHistoryTable');
    document.getElementById('bonusCountBadge').innerText = `${state.bonusHistory.length} Data`;

    const output = document.getElementById('bonusOutput');
    if (state.bonusHistory.length > 0) {
        const last = state.bonusHistory[state.bonusHistory.length - 1];
        output.innerHTML = `
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px; width:100%; margin-bottom:20px;">
                <div style="background:var(--sapphire-glow); border:1px solid rgba(91,143,232,0.15); border-radius:var(--radius); padding:16px;">
                    <p style="font-size:10px; color:var(--ivory-mute); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.08em; font-weight:700;">Livegame / Sport</p>
                    <p style="font-size:20px; font-weight:600; color:var(--sapphire-bright); font-family:var(--font-mono);">${fc(last.liveBonus)}</p>
                    <p style="font-size:10px; color:var(--ivory-mute); margin-top:6px;">Loss: ${fc(last.liveLoss)}</p>
                </div>
                <div style="background:var(--gold-glow2); border:1px solid rgba(201,150,43,0.15); border-radius:var(--radius); padding:16px;">
                    <p style="font-size:10px; color:var(--ivory-mute); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.08em; font-weight:700;">Slot</p>
                    <p style="font-size:20px; font-weight:600; color:var(--gold-mid); font-family:var(--font-mono);">${fc(last.slotBonus)}</p>
                    <p style="font-size:10px; color:var(--ivory-mute); margin-top:6px;">Loss: ${fc(last.slotLoss)}</p>
                </div>
            </div>
            <div style="border-top:1px solid var(--rim); padding-top:18px; text-align:center; width:100%;">
                <p style="font-size:10px; color:var(--ivory-mute); text-transform:uppercase; letter-spacing:0.1em; font-weight:700;">Total Bonus</p>
                <p class="total-display" style="margin-top:8px;">${fc(last.totalBonus)}</p>
                <p style="font-size:12px; color:var(--ivory-mute); margin-top:10px; letter-spacing:0.04em;">@${last.userId}</p>
            </div>
        `;
    } else {
        output.innerHTML = `<p style="color:var(--ivory-mute); font-size:13px;">Hasil perhitungan bonus akan muncul di sini</p>`;
    }

    if (state.bonusHistory.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:var(--ivory-mute); padding:28px; font-size:12px;">Belum ada riwayat</td></tr>`;
    } else {
        tbody.innerHTML = state.bonusHistory.slice().reverse().map((item, i) => {
            const idx = state.bonusHistory.length - 1 - i;
            return `<tr>
                <td class="mono" style="font-size:12px; color:var(--ivory);">@${item.userId}</td>
                <td style="font-size:11px; color:var(--ivory-mute);">${item.date}</td>
                <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:var(--rose-bright);">${fc(item.liveLoss + item.slotLoss)}</td>
                <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:var(--emerald-bright); font-weight:600;">${fc(item.totalBonus)}</td>
                <td style="text-align:center;"><button onclick="deleteBonus(${idx})" style="background:none; border:none; cursor:pointer; color:var(--ivory-mote); opacity:0.5; transition:opacity 0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.5">ðŸ—‘</button></td>
            </tr>`;
        }).join('');
    }
}

function updateDashboardStats() {
    let turnover = 0, loss = 0;
    Object.values(state.winlossData).forEach(cats => Object.values(cats).forEach(val => {
        if (val < 0) loss += Math.abs(val);
        turnover += Math.abs(val);
    }));
    const totalBonus = state.bonusHistory.reduce((s, i) => s + i.totalBonus, 0);
    animateValue('dashTurnover', turnover);
    animateValue('dashLoss', loss);
    animateValue('dashBonus', totalBonus);
    animateValue('dashSlotSessions', state.slotBonusHistory.length);
}

function updateActivityLog() {
    const tbody = document.getElementById('activityLogTable');
    if (!state.activityLog || state.activityLog.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; color:var(--ivory-mute); padding:28px; font-size:12px;">Belum ada aktivitas</td></tr>`;
        return;
    }
    tbody.innerHTML = state.activityLog.slice().reverse().slice(0,5).map(log => `
        <tr>
            <td style="font-size:11px; color:var(--ivory-mute); font-family:var(--font-mono);">${new Date(log.time).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'})}</td>
            <td><span class="badge ${log.type === 'WINLOSS' ? 'badge-sapphire' : log.type === 'SLOT_BONUS' ? 'badge-gold' : 'badge-emerald'}" style="font-size:9px;">${log.type}</span></td>
            <td style="font-size:12px; color:var(--ivory-dim);">${log.detail}</td>
            <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:${log.amount < 0 ? 'var(--rose-bright)' : 'var(--emerald-bright)'};">${fc(log.amount)}</td>
        </tr>
    `).join('');
}

// ============================================
// CHARTS
// ============================================
function initCharts() {
    const cCat = document.getElementById('categoryChart').getContext('2d');
    charts.category = new Chart(cCat, {
        type: 'doughnut',
        data: {
            labels: ['SLOT', 'LIVEGAME', 'SPORT'],
            datasets: [{ data: [0,0,0], backgroundColor: ['#C9962B','#5B8FE8','#22C987'], borderWidth: 0, hoverBorderWidth: 2, hoverBorderColor: '#1C2235' }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            cutout: '68%',
            plugins: { legend: { position: 'bottom', labels: { color: '#6B5E48', font: { size: 11, family: 'Outfit' }, padding: 16 } } }
        }
    });

    const cBonus = document.getElementById('bonusChart').getContext('2d');
    charts.bonus = new Chart(cBonus, {
        type: 'bar',
        data: { labels: [], datasets: [{ label: 'Bonus', data: [], backgroundColor: 'rgba(201,150,43,0.3)', borderColor: '#C9962B', borderWidth: 1, borderRadius: 6, borderSkipped: false }] },
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: {
                y: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#6B5E48', font: { size: 10 } }, border: { color: 'transparent' } },
                x: { grid: { display: false }, ticks: { color: '#6B5E48', font: { size: 10 } }, border: { color: 'transparent' } }
            },
            plugins: { legend: { display: false } }
        }
    });
}

function updateCharts() {
    const totals = { SLOT: 0, LIVEGAME: 0, SPORT: 0 };
    Object.keys(state.winlossData).forEach(cat => Object.values(state.winlossData[cat]).forEach(v => { if (totals[cat] !== undefined) totals[cat] += Math.abs(v); }));
    charts.category.data.datasets[0].data = [totals.SLOT, totals.LIVEGAME, totals.SPORT];
    charts.category.update();

    const recent = state.bonusHistory.slice(-10);
    charts.bonus.data.labels = recent.map(b => b.userId.substring(0,8));
    charts.bonus.data.datasets[0].data = recent.map(b => b.totalBonus);
    charts.bonus.update();
}

// ============================================
// SLOT BONUS MODULE LOGIC
// ============================================
function buildSbProviderInputs() {
    const groupContainer = document.getElementById('sbGroupInputs');
    groupContainer.innerHTML = '';
    
    Object.entries(SB_PROVIDER_GROUPS).forEach(([key, group]) => {
        group.providers.forEach(pName => {
            const div = document.createElement('div');
            div.className = 'prov-row gold';
            div.innerHTML = `
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="width:5px; height:5px; background:var(--gold); border-radius:50%; box-shadow:0 0 5px var(--gold);"></div>
                    <span style="font-size:12px; font-weight:600; color:var(--gold-light);">${pName}</span>
                    <span class="badge badge-gold" style="font-size:9px;">Gold</span>
                </div>
                <input type="number" id="sb_input_${pName.replace(/\s/g,'_')}" placeholder="0" min="0"
                    oninput="sbLiveUpdate()"
                    class="prov-inp gold-inp">
            `;
            groupContainer.appendChild(div);
        });
    });

    const normalContainer = document.getElementById('sbNormalInputs');
    normalContainer.innerHTML = '';
    SB_NORMAL_PROVIDERS.forEach(pName => {
        const div = document.createElement('div');
        div.className = 'prov-row';
        div.innerHTML = `
            <div style="display:flex; align-items:center; gap:10px;">
                <div style="width:5px; height:5px; background:var(--sapphire-bright); border-radius:50%;"></div>
                <span style="font-size:12px; color:var(--ivory-dim);">${pName}</span>
            </div>
            <input type="number" id="sb_input_${pName.replace(/\s/g,'_')}" placeholder="0" min="0"
                oninput="sbLiveUpdate()"
                class="prov-inp">
        `;
        normalContainer.appendChild(div);
    });
}

function renderSbGroupProviderList() {
    const container = document.getElementById('sbGroupProviderList');
    container.innerHTML = '';
    Object.values(SB_PROVIDER_GROUPS).forEach(group => {
        group.providers.forEach(p => {
            const div = document.createElement('div');
            div.style.cssText = `display:flex; align-items:center; gap:8px; padding:7px 10px; background:rgba(201,150,43,0.06); border:1px solid rgba(201,150,43,0.1); border-radius:var(--radius-sm); margin-bottom:5px;`;
            div.innerHTML = `<svg width="10" height="10" viewBox="0 0 24 24" fill="var(--gold)" xmlns="http://www.w3.org/2000/svg"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg><span style="font-size:12px; font-weight:600; color:var(--gold-light);">${p}</span>`;
            container.appendChild(div);
        });
    });
}

function updateSbPctDisplays() {
    const gPct = parseFloat(document.getElementById('sbGroupPct').value);
    const nPct = parseFloat(document.getElementById('sbNormalPct').value);
    document.getElementById('sbGroupPctDisplay').innerText = gPct + '%';
    document.getElementById('sbNormalPctDisplay').innerText = nPct + '%';
    document.getElementById('sbGroupPctNum').value = gPct;
    document.getElementById('sbNormalPctNum').value = nPct;
}

function syncSbPct(type) {
    if (type === 'group') document.getElementById('sbGroupPct').value = document.getElementById('sbGroupPctNum').value;
    else document.getElementById('sbNormalPct').value = document.getElementById('sbNormalPctNum').value;
    updateSbPctDisplays();
}

function applySbPeriodFilter() {
    const filter = document.getElementById('sbPeriodFilter').value;
    const today = new Date();
    let start = today, end = today;
    if (filter === 'week') { start = new Date(today); start.setDate(today.getDate() - today.getDay()); end = new Date(start); end.setDate(start.getDate() + 6); }
    else if (filter === 'month') { start = new Date(today.getFullYear(), today.getMonth(), 1); end = new Date(today.getFullYear(), today.getMonth() + 1, 0); }
    else if (filter === 'custom') return;
    const fmt = d => d.toISOString().split('T')[0];
    document.getElementById('sbStartDate').value = fmt(start);
    document.getElementById('sbEndDate').value = fmt(end);
}

function getSbInputValue(providerName) {
    const el = document.getElementById('sb_input_' + providerName.replace(/\s/g,'_'));
    return el ? (parseFloat(el.value) || 0) : 0;
}

function resetSbInputs() {
    document.querySelectorAll('[id^="sb_input_"]').forEach(el => el.value = '');
    document.getElementById('sbResultPanel').style.display = 'none';
    document.getElementById('sbReportPanel').style.display = 'none';
    lastSbResult = null;
}

function sbLiveUpdate() {}

function calculateSlotBonus() {
    const userId = document.getElementById('sbUserId').value.trim();
    if (!userId) return showToast('Error', 'Masukkan User ID', 'error');

    const groupPct = parseFloat(document.getElementById('sbGroupPct').value) / 100;
    const normalPct = parseFloat(document.getElementById('sbNormalPct').value) / 100;
    const minTurnover = parseFloat(document.getElementById('sbMinTurnover').value) || 0;

    const groupResults = {};
    Object.entries(SB_PROVIDER_GROUPS).forEach(([key, group]) => {
        let groupTotal = 0;
        const provBreakdown = {};
        group.providers.forEach(p => {
            const v = getSbInputValue(p);
            provBreakdown[p] = v;
            groupTotal += v;
        });
        const bonus = groupTotal * groupPct;
        groupResults[key] = { label: group.label, color: group.color, providers: provBreakdown, totalTurnover: groupTotal, bonusPct: groupPct, bonus };
    });

    const normalResults = {};
    SB_NORMAL_PROVIDERS.forEach(p => {
        const v = getSbInputValue(p);
        if (v > 0) normalResults[p] = { turnover: v, bonusPct: normalPct, bonus: v * normalPct };
    });

    const totalGroupTurnover = Object.values(groupResults).reduce((s, g) => s + g.totalTurnover, 0);
    const totalNormalTurnover = Object.values(normalResults).reduce((s, n) => s + n.turnover, 0);
    const totalTurnover = totalGroupTurnover + totalNormalTurnover;
    const totalGroupBonus = Object.values(groupResults).reduce((s, g) => s + g.bonus, 0);
    const totalNormalBonus = Object.values(normalResults).reduce((s, n) => s + n.bonus, 0);
    const totalBonus = totalGroupBonus + totalNormalBonus;
    const isEligible = totalTurnover >= minTurnover;

    lastSbResult = { userId, date: document.getElementById('sbStartDate').value, groupResults, normalResults, totalGroupTurnover, totalNormalTurnover, totalTurnover, totalGroupBonus, totalNormalBonus, totalBonus, isEligible, groupPct, normalPct, minTurnover };

    state.slotBonusHistory.push({ ...lastSbResult, id: Date.now() });
    logActivity('SLOT_BONUS', `User: ${userId}`, totalBonus);
    saveData(); updateUI();

    renderSbResult(lastSbResult);
    showToast(isEligible ? 'Bonus Dihitung âœ“' : 'Tidak Eligible', `Total: ${fc(totalBonus)}`, isEligible ? 'success' : 'info');
}

function renderSbResult(r) {
    const panel = document.getElementById('sbResultPanel');
    const content = document.getElementById('sbResultContent');
    panel.style.display = '';

    let html = `<div class="${r.isEligible ? 'eligible-yes' : 'eligible-no'}" style="margin-bottom:18px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
        <div>
            <p style="font-size:10px; font-weight:700; color:${r.isEligible ? 'var(--emerald-bright)' : 'var(--rose-bright)'}; text-transform:uppercase; letter-spacing:0.08em;">Status</p>
            <p style="font-size:18px; font-weight:700; color:${r.isEligible ? 'var(--emerald-bright)' : 'var(--rose-bright)'}; margin-top:4px; font-family:var(--font-display);">${r.isEligible ? 'âœ“ Eligible' : 'âœ— Tidak Eligible'}</p>
        </div>
        <div style="text-align:right;">
            <p style="font-size:10px; color:var(--ivory-mute);">Min. Turnover</p>
            <p style="font-size:14px; font-weight:600; color:var(--ivory); font-family:var(--font-mono); margin-top:3px;">${fc(r.minTurnover)}</p>
        </div>
    </div>`;

    html += `<div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:18px;">
        <div style="background:var(--gold-glow2); border:1px solid var(--rim-warm); border-radius:var(--radius); padding:14px;">
            <p style="font-size:10px; color:var(--gold-mid); font-weight:700; text-transform:uppercase; letter-spacing:0.08em; margin-bottom:6px;">Total Turnover</p>
            <p style="font-size:15px; font-weight:600; color:var(--ivory); font-family:var(--font-mono);">${fc(r.totalTurnover)}</p>
        </div>
        <div style="background:var(--sapphire-glow); border:1px solid rgba(91,143,232,0.12); border-radius:var(--radius); padding:14px;">
            <p style="font-size:10px; color:var(--sapphire-bright); font-weight:700; text-transform:uppercase; letter-spacing:0.08em; margin-bottom:6px;">Group Bonus</p>
            <p style="font-size:15px; font-weight:600; color:var(--ivory); font-family:var(--font-mono);">${fc(r.totalGroupBonus)}</p>
        </div>
        <div style="background:var(--emerald-glow); border:1px solid rgba(34,201,135,0.12); border-radius:var(--radius); padding:14px;">
            <p style="font-size:10px; color:var(--emerald-bright); font-weight:700; text-transform:uppercase; letter-spacing:0.08em; margin-bottom:6px;">Normal Bonus</p>
            <p style="font-size:15px; font-weight:600; color:var(--ivory); font-family:var(--font-mono);">${fc(r.totalNormalBonus)}</p>
        </div>
    </div>`;

    Object.values(r.groupResults).forEach(g => {
        const activeProviders = Object.entries(g.providers).filter(([,v]) => v > 0);
        if (g.totalTurnover === 0) return;
        html += `<div class="panel-gold" style="padding:16px; margin-bottom:10px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <span style="font-size:13px; font-weight:600; color:var(--gold-light); font-family:var(--font-display);">â­ ${g.label} <span style="font-size:11px; color:var(--gold-mid); font-weight:400;">(1Ã— Bonus @ ${(r.groupPct*100).toFixed(1)}%)</span></span>
                <span class="badge badge-gold">${fc(g.bonus)}</span>
            </div>`;
        Object.entries(g.providers).forEach(([pName, v]) => {
            if (v === 0) return;
            const pct = g.totalTurnover > 0 ? (v / g.totalTurnover * 100).toFixed(1) : '0';
            html += `<div style="display:flex; justify-content:space-between; padding:7px 0; border-bottom:1px solid rgba(201,150,43,0.08);">
                <span style="font-size:11px; color:var(--gold-mid);">â†³ ${pName}</span>
                <span class="mono" style="font-size:12px; color:var(--ivory);">${fc(v)} <span style="color:var(--ivory-mute); font-size:10px;">(${pct}%)</span></span>
            </div>`;
        });
        html += `<div style="display:flex; justify-content:space-between; margin-top:10px;">
            <span style="font-size:11px; font-weight:700; color:var(--gold-mid);">Total Group</span>
            <span class="mono" style="font-size:13px; font-weight:600; color:var(--gold-light);">${fc(g.totalTurnover)}</span>
        </div></div>`;
    });

    if (Object.keys(r.normalResults).length > 0) {
        html += `<div style="margin-bottom:14px;">
            <h4 style="font-size:10px; font-weight:700; color:var(--ivory-dim); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:10px;">Provider Normal (@ ${(r.normalPct*100).toFixed(1)}%)</h4>`;
        Object.entries(r.normalResults).forEach(([pName, n]) => {
            html += `<div class="prov-row" style="margin-bottom:5px;">
                <span style="font-size:12px; color:var(--ivory-dim);">${pName}</span>
                <div style="display:flex; align-items:center; gap:12px;">
                    <span class="mono" style="font-size:11px; color:var(--ivory-mute);">${fc(n.turnover)}</span>
                    <span class="badge badge-sapphire" style="font-size:10px;">+${fc(n.bonus)}</span>
                </div>
            </div>`;
        });
        html += `</div>`;
    }

    html += `<div style="background:linear-gradient(135deg, rgba(15,92,66,0.15), rgba(10,50,35,0.1)); border:1px solid rgba(34,201,135,0.15); border-radius:var(--radius); padding:22px; text-align:center; margin-top:6px;">
        <p style="font-size:10px; color:var(--emerald-bright); font-weight:700; text-transform:uppercase; letter-spacing:0.12em; margin-bottom:10px;">Total Bonus Final</p>
        <p class="total-display">${fc(r.totalBonus)}</p>
        <p style="font-size:11px; color:var(--ivory-mute); margin-top:10px; letter-spacing:0.04em;">@${r.userId} Â· ${r.date}</p>
    </div>`;

    content.innerHTML = html;
    renderSbRanking(r);
}

function renderSbRanking(r) {
    const container = document.getElementById('sbRankingContent');
    const all = [];
    Object.values(r.groupResults).forEach(g => Object.entries(g.providers).forEach(([p, v]) => { if (v > 0) all.push({ name: p, turnover: v, type: 'gold', bonus: v * r.groupPct }); }));
    Object.entries(r.normalResults).forEach(([p, n]) => all.push({ name: p, turnover: n.turnover, type: 'normal', bonus: n.bonus }));
    all.sort((a, b) => b.turnover - a.turnover);

    if (all.length === 0) { container.innerHTML = `<p style="color:var(--ivory-mute); font-size:12px; text-align:center;">Tidak ada data turnover</p>`; return; }

    const maxT = all[0].turnover;
    const medals = ['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'];
    let html = `<div style="display:flex; flex-direction:column; gap:10px;">`;
    all.forEach((item, i) => {
        const pct = (item.turnover / maxT * 100).toFixed(0);
        html += `<div style="display:flex; align-items:center; gap:10px;">
            <div style="width:26px; text-align:center; flex-shrink:0; font-size:${i < 3 ? '16' : '11'}px; color:var(--ivory-mute); font-weight:700;">${i < 3 ? medals[i] : '#' + (i+1)}</div>
            <div style="flex:1;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:12px; font-weight:600; color:${item.type === 'gold' ? 'var(--gold-light)' : 'var(--ivory-dim)'};">${item.name}</span>
                    <span class="mono" style="font-size:11px; color:var(--ivory-mute);">${fc(item.turnover)}</span>
                </div>
                <div class="prog-bar">
                    <div class="prog-fill" style="width:${pct}%; background:${item.type === 'gold' ? 'linear-gradient(90deg,var(--gold-deep),var(--gold))' : 'linear-gradient(90deg,var(--sapphire),var(--sapphire-bright))'}"></div>
                </div>
            </div>
        </div>`;
    });
    html += `</div>`;
    container.innerHTML = html;
}

function generateSlotReport() {
    if (!lastSbResult) return showToast('Error', 'Hitung bonus terlebih dahulu', 'error');
    const r = lastSbResult;
    const toBold = (str) => str.split('').map(c => {
        if (c >= 'A' && c <= 'Z') return String.fromCodePoint(0x1D400 + c.charCodeAt(0) - 65);
        if (c >= 'a' && c <= 'z') return String.fromCodePoint(0x1D41A + c.charCodeAt(0) - 97);
        if (c >= '0' && c <= '9') return String.fromCodePoint(0x1D7CE + c.charCodeAt(0) - 48);
        return c;
    }).join('');

    let report = `${toBold('LAPORAN BONUS SLOT')}\n`;
    report += `User: @${r.userId}  |  Tanggal: ${r.date}\n`;
    report += `Status: ${r.isEligible ? 'âœ… ELIGIBLE' : 'âŒ TIDAK ELIGIBLE'}\n`;
    report += `${'â”€'.repeat(42)}\n\n`;
    report += `${toBold('GOLD GROUP')} (1Ã— Bonus â€” Anti Double Count)\n`;
    Object.values(r.groupResults).forEach(g => {
        if (g.totalTurnover > 0) {
            Object.entries(g.providers).forEach(([p, v]) => { if (v > 0) report += `  ${p}: ${fc(v)}\n`; });
            report += `  Total Group : ${fc(g.totalTurnover)}\n`;
            report += `  Bonus (${(r.groupPct*100).toFixed(1)}%) : ${fc(g.bonus)}\n\n`;
        }
    });
    if (Object.keys(r.normalResults).length > 0) {
        report += `${toBold('PROVIDER NORMAL')} (Individual)\n`;
        Object.entries(r.normalResults).forEach(([p, n]) => report += `  ${p}: ${fc(n.turnover)}  â†’  Bonus: ${fc(n.bonus)}\n`);
        report += `\n`;
    }
    report += `${'â”€'.repeat(42)}\n`;
    report += `Total Turnover  : ${toBold(fc(r.totalTurnover))}\n`;
    report += `Total Bonus     : ${toBold(fc(r.totalBonus))}\n`;

    document.getElementById('sbReportOutput').value = report;
    document.getElementById('sbReportPanel').style.display = '';
    showToast('Report', 'Laporan berhasil dibuat');
}

function copySbReport() {
    navigator.clipboard.writeText(document.getElementById('sbReportOutput').value)
        .then(() => showToast('Tersalin', 'Laporan disalin ke clipboard'));
}

function exportSlotBonusPDF() {
    if (!lastSbResult) return showToast('Error', 'Hitung bonus terlebih dahulu', 'error');
    window.print();
}

function updateSbHistory() {
    const tbody = document.getElementById('sbHistoryTable');
    const badge = document.getElementById('sbHistoryCountBadge');
    badge.innerText = `${state.slotBonusHistory.length} Session`;

    if (state.slotBonusHistory.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center; color:var(--ivory-mute); padding:28px; font-size:12px;">Belum ada riwayat</td></tr>`;
        return;
    }

    tbody.innerHTML = state.slotBonusHistory.slice().reverse().map((item, i) => {
        const idx = state.slotBonusHistory.length - 1 - i;
        return `<tr>
            <td class="mono" style="font-size:12px; color:var(--ivory);">@${item.userId}</td>
            <td style="font-size:11px; color:var(--ivory-mute);">${item.date}</td>
            <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:var(--gold-mid);">${fc(item.totalTurnover)}</td>
            <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:var(--sapphire-bright);">${fc(item.totalGroupBonus)}</td>
            <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:var(--ivory-dim);">${fc(item.totalNormalBonus)}</td>
            <td style="text-align:right; font-family:var(--font-mono); font-size:12px; color:var(--emerald-bright); font-weight:600;">${fc(item.totalBonus)}</td>
            <td><span class="badge ${item.isEligible ? 'badge-emerald' : 'badge-rose'}" style="font-size:9px;">${item.isEligible ? 'Eligible' : 'Tidak'}</span></td>
            <td style="text-align:center;"><button onclick="deleteSbHistory(${idx})" style="background:none; border:none; cursor:pointer; opacity:0.4; transition:opacity 0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.4">ðŸ—‘</button></td>
        </tr>`;
    }).join('');
}

function deleteSbHistory(idx) {
    if (confirm('Hapus data ini?')) {
        state.slotBonusHistory.splice(idx, 1);
        saveData(); updateUI();
        showToast('Terhapus', 'Data riwayat dihapus');
    }
}

function clearSbHistory() {
    if (confirm('Hapus semua riwayat slot bonus?')) {
        state.slotBonusHistory = [];
        saveData(); updateUI();
        showToast('Reset', 'Riwayat slot bonus dihapus');
    }
}

// ============================================
// UTILS
// ============================================
function logActivity(type, detail, amount) {
    if (!state.activityLog) state.activityLog = [];
    state.activityLog.push({ time: Date.now(), type, detail, amount });
}

function fc(amount) {
    return new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(amount);
}

function animateValue(id, value) {
    const el = document.getElementById(id);
    if (el) el.innerText = new Intl.NumberFormat('id-ID', { notation: 'compact' }).format(value);
}

function deleteBonus(index) {
    if (confirm('Hapus data bonus ini?')) {
        state.bonusHistory.splice(index, 1);
        saveData(); updateUI();
        showToast('Terhapus', 'Data bonus dihapus');
    }
}

function clearAllData() {
    if (confirm('PERINGATAN: Semua data akan dihapus permanen. Lanjutkan?')) {
        localStorage.removeItem('winlossCalcProData_v5');
        localStorage.removeItem('winlossCalcProData');
        state = { winlossData: {}, bonusHistory: [], activityLog: [], slotBonusHistory: [] };
        updateUI(); updateCharts();
        showToast('Reset', 'Aplikasi di-reset ke awal');
    }
}

function copyToClipboard() {
    const text = document.getElementById('reportOutput').innerText;
    navigator.clipboard.writeText(text).then(() => showToast('Tersalin', 'Laporan disalin ke clipboard'));
}

let toastTimer;
function showToast(title, msg, type = 'success') {
    const toast = document.getElementById('toast');
    document.getElementById('toastTitle').innerText = title;
    document.getElementById('toastMessage').innerText = msg;
    const colors = { success: 'var(--emerald-bright)', error: 'var(--rose-bright)', info: 'var(--gold-mid)' };
    const icons = {
        success: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="${colors.success}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
        error:   `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="${colors.error}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>`,
        info:    `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="${colors.info}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/></svg>`
    };
    document.getElementById('toastIcon').innerHTML = icons[type] || icons.success;
    clearTimeout(toastTimer);
    toast.classList.add('show');
    toastTimer = setTimeout(() => toast.classList.remove('show'), 3200);
}

function exportData() {
    const a = document.createElement('a');
    a.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(state));
    a.download = 'backup_winloss_v5_' + new Date().toISOString().slice(0,10) + '.json';
    document.body.appendChild(a); a.click(); a.remove();
    showToast('Backup', 'File JSON berhasil didownload');
}

function importData(input) {
    const file = input.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const json = JSON.parse(e.target.result);
            if (json.winlossData || json.bonusHistory) {
                state = { winlossData: {}, bonusHistory: [], activityLog: [], slotBonusHistory: [], ...json };
                saveData(); updateUI(); updateCharts();
                showToast('Restore', 'Data berhasil dipulihkan');
            } else throw new Error();
        } catch { showToast('Error', 'File JSON tidak valid', 'error'); }
    };
    reader.readAsText(file);
    input.value = '';
}

function setupDragDrop() {
    const dropZone = document.getElementById('dropZone');
    const textArea = document.getElementById('dataInput');
    if (!dropZone) return;
    ['dragenter','dragover','dragleave','drop'].forEach(ev => dropZone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); }));
    dropZone.addEventListener('dragenter', () => dropZone.classList.add('active'));
    dropZone.addEventListener('dragover',  () => dropZone.classList.add('active'));
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('active'));
    dropZone.addEventListener('drop', e => {
        dropZone.classList.remove('active');
        if (e.dataTransfer.files.length > 0) {
            const r = new FileReader();
            r.onload = ev => { textArea.value = ev.target.result; };
            r.readAsText(e.dataTransfer.files[0]);
        }
    });
}
</script>
</body>
</html>
